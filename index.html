<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>VICE CHANGER TOOL</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background: #111; color: #fff; }
    button { margin: 10px; padding: 10px 20px; font-size: 16px; border-radius: 8px; border: none; cursor: pointer; }
    button:hover { opacity: 0.8; }
    footer { margin-top: 40px; font-size: 14px; color: #aaa; }
  </style>
</head>
<body>
  <h1>VICE CHANGER TOOL</h1>

  <button id="recordBtn">START RECORDING</button>
  <button id="stopBtn" disabled>STOP</button>
  <button id="processBtn" disabled>START CHANGE YOUR VICE</button>
  <button id="playBtn" disabled>PLAY VICE</button>
  <button id="downloadBtn" disabled>DOWNLOAD</button>

  <audio id="audioPlayer" controls style="display:none;"></audio>

  <footer>
    POWERED BY OLD-STUDIO <br>
    FOLLOW ON WHATSAPP <br>
    <a href="https://whatsapp.com/channel/0029VavHzv259PwTIz1XxJ09" target="_blank" style="color:#0f0;">Click Here</a>
  </footer>

  <script>
    let mediaRecorder, audioChunks = [], processedBlob;

    const recordBtn = document.getElementById("recordBtn");
    const stopBtn = document.getElementById("stopBtn");
    const processBtn = document.getElementById("processBtn");
    const playBtn = document.getElementById("playBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const audioPlayer = document.getElementById("audioPlayer");

    recordBtn.onclick = async () => {
      let stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      audioChunks = [];
      mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
      mediaRecorder.start();
      recordBtn.disabled = true;
      stopBtn.disabled = false;
    };

    stopBtn.onclick = () => {
      mediaRecorder.stop();
      stopBtn.disabled = true;
      processBtn.disabled = false;
    };

    processBtn.onclick = async () => {
      const audioBlob = new Blob(audioChunks, { type: "audio/webm" });
      const formData = new FormData();
      formData.append("audio", audioBlob, "recording.webm");

      const response = await fetch("http://172.18.62.1:5000", {
        method: "POST",
        body: formData
      });

      const arrayBuffer = await response.arrayBuffer();
      processedBlob = new Blob([arrayBuffer], { type: "audio/webm" });
      audioPlayer.src = URL.createObjectURL(processedBlob);
      audioPlayer.style.display = "block";
      playBtn.disabled = false;
      downloadBtn.disabled = false;
    };

    playBtn.onclick = () => {
      audioPlayer.play();
    };

    downloadBtn.onclick = () => {
      const a = document.createElement("a");
      a.href = URL.createObjectURL(processedBlob);
      a.download = "changed-voice.webm";
      a.click();
    };
  </script>
</body>
</html>
